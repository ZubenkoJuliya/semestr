import requests  # –î–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è HTTP-–∑–∞–ø—Ä–æ—Å–æ–≤ –∫ —Å–∞–π—Ç—É
from bs4 import BeautifulSoup  # –î–ª—è –ø–∞—Ä—Å–∏–Ω–≥–∞ HTML-—Å—Ç—Ä–∞–Ω–∏—Ü
import random  # –î–ª—è –≤—ã–±–æ—Ä–∞ —Å–ª—É—á–∞–π–Ω–æ–π –∫–Ω–∏–≥–∏ –∏–∑ —Å–ø–∏—Å–∫–∞

class BookScraper:
    def scrape_books_from_site(self):
        """
        –ú–µ—Ç–æ–¥ –¥–ª—è –ø–∞—Ä—Å–∏–Ω–≥–∞ –∫–Ω–∏–≥ —Å —Å–∞–π—Ç–∞ books.toscrape.com.
        –°–æ–±–∏—Ä–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –æ –∫–Ω–∏–≥–∞—Ö —Å –ø–µ—Ä–≤–æ–π –∏ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —Å–ª–µ–¥—É—é—â–∏—Ö —Å—Ç—Ä–∞–Ω–∏—Ü.
        –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–ø–∏—Å–æ–∫ —Å–ª–æ–≤–∞—Ä–µ–π —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ –∫–Ω–∏–≥–∞—Ö.
        """
        base_url = "http://books.toscrape.com/catalogue/page-{}.html"  # –®–∞–±–ª–æ–Ω URL –¥–ª—è —Å—Ç—Ä–∞–Ω–∏—Ü —Å –∫–Ω–∏–≥–∞–º–∏ (—Å–æ 2-–π –ø–æ 5-—é)
        books_data = []  # –°–ø–∏—Å–æ–∫ –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –∫–Ω–∏–≥–∞—Ö

        # –ü–µ—Ä–≤–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ - index.html, –æ—Å—Ç–∞–ª—å–Ω—ã–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã - page-2.html, page-3.html –∏ —Ç.–¥.
        # –ü–æ—ç—Ç–æ–º—É —Ñ–æ—Ä–º–∏—Ä—É–µ–º —Å–ø–∏—Å–æ–∫ URL: —Å–Ω–∞—á–∞–ª–∞ index.html, –∑–∞—Ç–µ–º —Å—Ç—Ä–∞–Ω–∏—Ü—ã —Å 2 –ø–æ 5
        urls = ["http://books.toscrape.com/index.html"] + [base_url.format(i) for i in range(2, 6)]

        headers = {"User-Agent": "Mozilla/5.0"}  # –ó–∞–≥–æ–ª–æ–≤–æ–∫ User-Agent –¥–ª—è –∏–º–∏—Ç–∞—Ü–∏–∏ –∑–∞–ø—Ä–æ—Å–∞ –æ—Ç –±—Ä–∞—É–∑–µ—Ä–∞

        # –ü—Ä–æ—Ö–æ–¥–∏–º –ø–æ –∫–∞–∂–¥–æ–º—É URL –∏–∑ —Å–ø–∏—Å–∫–∞
        for url in urls:
            try:
                # –í—ã–ø–æ–ª–Ω—è–µ–º GET-–∑–∞–ø—Ä–æ—Å –∫ —Å—Ç—Ä–∞–Ω–∏—Ü–µ —Å —Ç–∞–π–º–∞—É—Ç–æ–º 10 —Å–µ–∫—É–Ω–¥
                response = requests.get(url, headers=headers, timeout=10)
                response.raise_for_status()  # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –∑–∞–ø—Ä–æ—Å —É—Å–ø–µ—à–µ–Ω (–∫–æ–¥ 200)
            except requests.RequestException as e:
                # –ï—Å–ª–∏ –≤–æ–∑–Ω–∏–∫–ª–∞ –æ—à–∏–±–∫–∞ –∑–∞–ø—Ä–æ—Å–∞, –≤–æ–∑–≤—Ä–∞—â–∞–µ–º —Å–ø–∏—Å–æ–∫ —Å –æ–¥–Ω–∏–º —ç–ª–µ–º–µ–Ω—Ç–æ–º ‚Äî –æ–ø–∏—Å–∞–Ω–∏–µ–º –æ—à–∏–±–∫–∏,
                # —á—Ç–æ–±—ã –Ω–µ –ø—Ä–µ—Ä—ã–≤–∞—Ç—å —Ä–∞–±–æ—Ç—É –ø—Ä–æ–≥—Ä–∞–º–º—ã
                return [{"title": "–û—à–∏–±–∫–∞ –∑–∞–ø—Ä–æ—Å–∞", "price": "-", "availability": "-", "rating": str(e)}]

            # –ü–∞—Ä—Å–∏–º HTML-–∫–æ–¥ —Å—Ç—Ä–∞–Ω–∏—Ü—ã —Å –ø–æ–º–æ—â—å—é BeautifulSoup
            soup = BeautifulSoup(response.text, "html.parser")
            # –ù–∞—Ö–æ–¥–∏–º –≤—Å–µ —ç–ª–µ–º–µ–Ω—Ç—ã –∫–Ω–∏–≥ - –æ–Ω–∏ –Ω–∞—Ö–æ–¥—è—Ç—Å—è –≤ —Ç–µ–≥–∞—Ö <article> —Å –∫–ª–∞—Å—Å–æ–º product_pod
            book_elements = soup.select("article.product_pod")

            # –ü—Ä–æ—Ö–æ–¥–∏–º –ø–æ –∫–∞–∂–¥–æ–π –∫–Ω–∏–≥–µ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ
            for book in book_elements:
                # –ü–æ–ª—É—á–∞–µ–º –Ω–∞–∑–≤–∞–Ω–∏–µ –∫–Ω–∏–≥–∏ –∏–∑ –∞—Ç—Ä–∏–±—É—Ç–∞ title —Ç–µ–≥–∞ <a> –≤–Ω—É—Ç—Ä–∏ <h3>
                title = book.h3.a["title"]
                # –ü–æ–ª—É—á–∞–µ–º —Ü–µ–Ω—É –∫–Ω–∏–≥–∏ (—Ç–µ–∫—Å—Ç –≤–Ω—É—Ç—Ä–∏ —ç–ª–µ–º–µ–Ω—Ç–∞ —Å –∫–ª–∞—Å—Å–æ–º price_color)
                price = book.select_one(".price_color").text
                # –ü–æ–ª—É—á–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –Ω–∞–ª–∏—á–∏–∏ –∫–Ω–∏–≥–∏, —É–±–∏—Ä–∞—è –ª–∏—à–Ω–∏–µ –ø—Ä–æ–±–µ–ª—ã
                availability = book.select_one(".availability").text.strip()
                # –ü–æ–ª—É—á–∞–µ–º —Å–ø–∏—Å–æ–∫ –∫–ª–∞—Å—Å–æ–≤ —Ç–µ–≥–∞ <p> —Å –∫–ª–∞—Å—Å–æ–º star-rating, –Ω–∞–ø—Ä–∏–º–µ—Ä ["star-rating", "Three"]
                rating_class = book.select_one("p.star-rating")["class"]

                # –ù–∞—Ö–æ–¥–∏–º —Å–ª–æ–≤–æ —Ä–µ–π—Ç–∏–Ω–≥–∞, –∏—Å–∫–ª—é—á–∞—è "star-rating"
                rating_word = next((cls for cls in rating_class if cls != "star-rating"), "No rating")

                # –°–æ–ø–æ—Å—Ç–∞–≤–ª—è–µ–º —Å–ª–æ–≤–µ—Å–Ω—ã–π —Ä–µ–π—Ç–∏–Ω–≥ —Å —á–∏—Å–ª–æ–≤—ã–º –∑–Ω–∞—á–µ–Ω–∏–µ–º
                rating_map = {
                    "One": 1,
                    "Two": 2,
                    "Three": 3,
                    "Four": 4,
                    "Five": 5
                }
                rating = rating_map.get(rating_word, 0)  # –ï—Å–ª–∏ —Ä–µ–π—Ç–∏–Ω–≥ –Ω–µ –Ω–∞–π–¥–µ–Ω, —Å—Ç–∞–≤–∏–º 0

                # –î–æ–±–∞–≤–ª—è–µ–º —Å–ª–æ–≤–∞—Ä—å —Å –¥–∞–Ω–Ω—ã–º–∏ –∫–Ω–∏–≥–∏ –≤ –æ–±—â–∏–π —Å–ø–∏—Å–æ–∫
                books_data.append({
                    "title": title,
                    "price": price,
                    "availability": availability,
                    "rating": rating
                })

        # –í–æ–∑–≤—Ä–∞—â–∞–µ–º —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö —Å–æ–±—Ä–∞–Ω–Ω—ã—Ö –∫–Ω–∏–≥
        return books_data

    def get_random_book(self):
        """
        –ú–µ—Ç–æ–¥ –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —Å–ª—É—á–∞–π–Ω–æ–π –∫–Ω–∏–≥–µ.
        –í—ã–±–∏—Ä–∞–µ—Ç —Å–ª—É—á–∞–π–Ω—É—é –∫–Ω–∏–≥—É –∏–∑ —Å–ø–∏—Å–∫–∞, –ø–æ–ª—É—á–µ–Ω–Ω–æ–≥–æ –º–µ—Ç–æ–¥–æ–º scrape_books_from_site.
        –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–Ω—É—é —Å—Ç—Ä–æ–∫—É —Å –¥–∞–Ω–Ω—ã–º–∏ –∫–Ω–∏–≥–∏.
        """
        books = self.scrape_books_from_site()  # –ü–æ–ª—É—á–∞–µ–º —Å–ø–∏—Å–æ–∫ –∫–Ω–∏–≥
        if books:
            random_book = random.choice(books)  # –í—ã–±–∏—Ä–∞–µ–º —Å–ª—É—á–∞–π–Ω—É—é –∫–Ω–∏–≥—É
            # –§–æ—Ä–º–∏—Ä—É–µ–º —Å—Ç—Ä–æ–∫—É —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ –∫–Ω–∏–≥–µ –¥–ª—è –≤—ã–≤–æ–¥–∞
            return (f"üìö –°–ª—É—á–∞–π–Ω–∞—è –∫–Ω–∏–≥–∞:\n"
                    f"–ù–∞–∑–≤–∞–Ω–∏–µ: {random_book['title']}\n"
                    f"–¶–µ–Ω–∞: {random_book['price']}\n"
                    f"–ù–∞–ª–∏—á–∏–µ: {random_book['availability']}\n"
                    f"–†–µ–π—Ç–∏–Ω–≥: {random_book['rating']}")
        # –ï—Å–ª–∏ —Å–ø–∏—Å–æ–∫ –∫–Ω–∏–≥ –ø—É—Å—Ç–æ–π, –≤–æ–∑–≤—Ä–∞—â–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ
        return "–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å —Å–ª—É—á–∞–π–Ω—É—é –∫–Ω–∏–≥—É."
